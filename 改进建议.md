# PDF AIé˜…è¯»åŠ©æ‰‹ - æ ¸å¿ƒé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

## ğŸ”´ æ ¸å¿ƒé—®é¢˜

### é—®é¢˜1: æ–‡æœ¬é€‰æ‹©åŠŸèƒ½ä¸å·¥ä½œ â˜…â˜…â˜…â˜…â˜…
**ç°çŠ¶**: `frontend/app.js:263` ä½¿ç”¨ `window.getSelection()` ä»canvasè·å–æ–‡æœ¬
**åŸå› **: PDFæ¸²æŸ“åœ¨canvasä¸Šï¼Œcanvaså†…å®¹æ— æ³•è¢«é€‰ä¸­
**å½±å“**: ç”¨æˆ·æ— æ³•æ¡†é€‰æ–‡æœ¬ï¼Œå³é”®èœå•åŠŸèƒ½å¤±æ•ˆ

### é—®é¢˜2: PDFæ–‡ä»¶åŠ è½½å¤±è´¥ â˜…â˜…â˜…â˜…â˜…
**ç°çŠ¶**: `frontend/app.js:117` è°ƒç”¨ `/pdfs/{id}/file` æ¥å£
**åŸå› **: åç«¯æ²¡æœ‰è¿™ä¸ªè·¯ç”±
**å½±å“**: PDFæ— æ³•åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤º

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤1: æ·»åŠ PDF.jsæ–‡æœ¬å±‚

**1. ä¿®æ”¹ `frontend/index.html`**
```html
<!-- æ‰¾åˆ° pdf-viewer éƒ¨åˆ†ï¼Œæ”¹ä¸ºï¼š -->
<div class="pdf-viewer">
    <div style="position: relative;">
        <canvas id="pdf-canvas"></canvas>
        <div id="text-layer" class="textLayer"></div>
    </div>
</div>
```

**2. ä¿®æ”¹ `frontend/styles.css`**
```css
.textLayer {
    position: absolute;
    left: 0;
    top: 0;
    overflow: hidden;
    opacity: 1;
    line-height: 1.0;
}

.textLayer > span {
    color: transparent;
    position: absolute;
    white-space: pre;
    cursor: text;
    transform-origin: 0% 0%;
}

.textLayer ::selection {
    background: rgba(0, 123, 255, 0.3);
}
```

**3. ä¿®æ”¹ `frontend/app.js` çš„ renderPage å‡½æ•°**
```javascript
async function renderPage(pageNum) {
    const page = await currentPDFDoc.getPage(pageNum);
    const canvas = document.getElementById('pdf-canvas');
    const context = canvas.getContext('2d');

    const viewport = page.getViewport({ scale: 1.5 });
    canvas.height = viewport.height;
    canvas.width = viewport.width;

    // æ¸²æŸ“è§†è§‰å±‚
    await page.render({ canvasContext: context, viewport: viewport }).promise;

    // ğŸ†• æ¸²æŸ“æ–‡æœ¬å±‚
    const textContent = await page.getTextContent();
    const textLayerDiv = document.getElementById('text-layer');
    textLayerDiv.innerHTML = '';
    textLayerDiv.style.width = canvas.width + 'px';
    textLayerDiv.style.height = canvas.height + 'px';

    pdfjsLib.renderTextLayer({
        textContentSource: textContent,
        container: textLayerDiv,
        viewport: viewport,
        textDivs: []
    });

    document.getElementById('page-info').textContent = `${pageNum} / ${totalPages}`;
}
```

### ä¿®å¤2: æ·»åŠ PDFæ–‡ä»¶è®¿é—®è·¯ç”±

**ä¿®æ”¹ `backend/app/routes/pdf_routes.py`**
```python
# åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ 
from fastapi.responses import FileResponse
import os

# åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ 
@router.get("/{pdf_id}/file")
async def get_pdf_file(pdf_id: int, db: Session = Depends(get_db)):
    """è·å–PDFæ–‡ä»¶"""
    pdf = db.query(PDF).filter(PDF.id == pdf_id).first()
    if not pdf:
        raise HTTPException(status_code=404, detail="PDF not found")

    if not os.path.exists(pdf.file_path):
        raise HTTPException(status_code=404, detail="File not found")

    return FileResponse(pdf.file_path, media_type='application/pdf')
```

---

## ğŸš€ å®æ–½æ­¥éª¤

1. ä¿®æ”¹ `frontend/index.html` - æ·»åŠ æ–‡æœ¬å±‚å®¹å™¨
2. ä¿®æ”¹ `frontend/styles.css` - æ·»åŠ æ–‡æœ¬å±‚æ ·å¼
3. ä¿®æ”¹ `frontend/app.js` - é‡å†™renderPageå‡½æ•°
4. ä¿®æ”¹ `backend/app/routes/pdf_routes.py` - æ·»åŠ æ–‡ä»¶è·¯ç”±
5. é‡å¯åç«¯æœåŠ¡å™¨
6. åˆ·æ–°å‰ç«¯é¡µé¢æµ‹è¯•

---

## ğŸ“Š æµ‹è¯•éªŒè¯

å®Œæˆåæµ‹è¯•ï¼š
- [ ] ä¸Šä¼ PDFèƒ½æ­£å¸¸æ˜¾ç¤º
- [ ] é¼ æ ‡å¯ä»¥é€‰ä¸­PDFä¸­çš„æ–‡å­—
- [ ] é€‰ä¸­æ–‡å­—åå³é”®èœå•å‡ºç°
- [ ] ç‚¹å‡»"è§£é‡Š"ã€"ç¿»è¯‘"ã€"æ€»ç»“"åŠŸèƒ½æ­£å¸¸
- [ ] AIå›å¤æ˜¾ç¤ºåœ¨å³ä¾§èŠå¤©æ¡†

---

## ğŸ’¡ åç»­ä¼˜åŒ–å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**: åœ¨ `gemini_service.py` æ·»åŠ PDF base64ç¼“å­˜ï¼Œé¿å…é‡å¤ç¼–ç 
2. **ä½“éªŒä¼˜åŒ–**: é€‰ä¸­æ–‡å­—ååœ¨èŠå¤©æ¡†ä¸Šæ–¹æ˜¾ç¤ºé¢„è§ˆ
3. **æ™ºèƒ½æç¤º**: æ”¹è¿›AI promptï¼Œè®©å®ƒçŸ¥é“å½“å‰é¡µç å’Œæ–‡æ¡£ä¸Šä¸‹æ–‡
